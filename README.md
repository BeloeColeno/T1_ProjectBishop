# Project Bishop

## Overview
Это приложение - домашнее задание для ИТ-лагеря Т1. Приложение реализует Spring Boot Starter, который позволяет обрабатывать события в приложении.
Подразумевается, что приложение отправляет команды для Андройда, которые тот должен исполнить, а стартер должен помочь отправить эту команду андройду и вывести сообщение в консоль или Kafka.

## Requirements
- Java 23 or higher
- Docker

## Setup
1. Поднимите сервис Kafka с помощью Docker из директории проекта: 
```
docker-compose up -d
```
2. Соберите проект с помощью Maven:
```
cd ../synthetic-human-core-starter
mvn clean install
```
3. Запустите приложение (не в докере, просто с локальной машины).

## Usage
1. После запуска Kafka в Docker будет возможность открыть UI Kafka по адресу http://localhost:8090. В нем можно будет увидеть топики и сообщения, которые отправляет приложение.
2. Что бы отправить сообщение нужно обращаться к ручкам приложения:
 - Endpoint 1: `POST /api/commands/kafka-audit`
 - Endpoint 2: `POST /api/commands/console-audit`
   - Эти ручки отправляют команды в Kafka и консоль соответственно. В теле запроса нужно указать JSON с полями:
```json
{
  "description": "description", (!>1000 символов)
  "priority": "COMMON | CRITICAL",
  "author": "author", (!>100 символов)
  "time": "YYYY-MM-DDTHH:MM:SS.sssZ" (JSON формат даты)
}
```
3. В приложении предусмотрен просмотр статистики:
- Endpoint 3: `GET /monitoring/queue-sizes`
  - Возвращает количество задач, которые Андроид выполняет в текущий момент времени.
- Endpoint 4: `GET /monitoring/tasks-completed`
  - Возвращает количество выполненных задач Андройдом за все время работы с указанием авторства задачи.

## Testing

В папке scratches приложения bishop-project созданы 2 файла:
- `Test_Requests.http` - содержит команды, которые можно отправить в приложение для быстрого тестирования. В нем так же есть команды для получения статистики с помощью ручных методов.
- `Metrics_Requests.http` - содержит команды для получения метрик из приложения с помощью Actuator и Micrometer.

## Description of the creative part
В стартере согласно техническому заданию реализована очередь задач, в которую попадают задачи, отправленные на ручки 1 и 2. При поднятии приложения создаются Андройды (Worker), которые обрабатывают задачи из очереди.

Количество Андроидов можно настроить в файле `application.properties` с помощью параметра `synthetic.weyland.workers.count`. Так же можно настроить скорость обработки задач с помощью параметра `synthetic.weyland.workers.task-execution-time-seconds`.

По умолчанию, если не настраивать параметры в приложении, в стартере указаны внедряемые значения `synthetic.weyland.workers.count=1` и `synthetic.weyland.workers.task-execution-time-seconds=10`.

Условные андройды берут задачи из очереди в работу в зависимости от ее приоритета и выполняют их в течении указанного времени. Ход работы отправляется в консоль в виде логов.

    
